@model Web.Models.OrdemDetalhesViewModel
@{
    ViewData["Title"] = "Detalhes da Ordem de Serviço";
    Layout = "~/Views/Shared/_LayoutLogado.cshtml";
}

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">
            <div class="card shadow">
                <div class="card-header bg-info text-white">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-receipt me-2"></i>
                            <h4 class="mb-0">Detalhes da Ordem de Serviço</h4>
                        </div>
                        <a asp-action="Listar" class="btn btn-light btn-sm">
                            <i class="bi bi-arrow-left me-1"></i>Voltar
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 text-center mb-4">
                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" 
                                 style="width: 120px; height: 120px;">
                                <i class="bi bi-receipt text-white" style="font-size: 3rem;"></i>
                            </div>
                            <h5 class="text-primary">Ordem #@Model.Id.ToString().Substring(0, 8)</h5>
                        </div>
                        
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-sm-6 mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="bi bi-hash me-1"></i>ID da Ordem
                                    </label>
                                    <p class="form-control-plaintext">
                                        <code class="text-muted">@Model.Id</code>
                                    </p>
                                </div>
                                
                                <div class="col-sm-6 mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="bi bi-calendar-plus me-1"></i>Data/Hora de Registro
                                    </label>
                                    <p class="form-control-plaintext">
                                        @Model.DataHoraRegistro.ToString("dd/MM/yyyy 'às' HH:mm:ss")
                                    </p>
                                </div>
                                
                                <div class="col-sm-6 mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="bi bi-toggle-on me-1"></i>Status
                                    </label>
                                    <p class="form-control-plaintext">
                                        <span class="badge @(Model.Status == "Aberta" ? "bg-success" : Model.Status == "Fechada" ? "bg-primary" : "bg-warning") fs-6">
                                            @Model.Status
                                        </span>
                                    </p>
                                </div>
                                
                                <div class="col-sm-6 mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="bi bi-currency-dollar me-1"></i>Valor Total
                                    </label>
                                    <p class="form-control-plaintext text-success fw-bold fs-5">
                                        R$ @Model.Total.ToString("N2")
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card-footer bg-light">
                    <div class="d-flex justify-content-between">
                        <a asp-action="Listar" class="btn btn-secondary">
                            <i class="bi bi-arrow-left me-1"></i>Voltar à Lista
                        </a>
                        <div>
                            <a asp-action="Index" class="btn btn-primary me-2">
                                <i class="bi bi-plus-circle me-1"></i>Nova Ordem
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card de Produtos -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="bi bi-box-seam me-2"></i>Produtos da Ordem (@Model.Produtos.Count item(s))
                    </h6>
                </div>
                <div class="card-body p-0">
                    @if (Model.Produtos.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Produto</th>
                                        <th>Quantidade</th>
                                        <th>Valor Unitário</th>
                                        <th>Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var produto in Model.Produtos)
                                    {
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="bg-info rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 35px; height: 35px;">
                                                        <i class="bi bi-box text-white"></i>
                                                    </div>
                                                    <div>
                                                        <strong>@produto.NomeProduto</strong>
                                                        <br>
                                                        <small class="text-muted">ID: @produto.ProdutoId.ToString().Substring(0, 8)...</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-primary fs-6">
                                                    @produto.Quantidade
                                                </span>
                                            </td>
                                            <td>
                                                <span class="fw-bold">R$ @produto.Valor.ToString("N2")</span>
                                            </td>
                                            <td>
                                                <span class="fw-bold text-success">R$ @produto.Subtotal.ToString("N2")</span>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                                <tfoot class="table-light">
                                    <tr>
                                        <th colspan="3" class="text-end">Total da Ordem:</th>
                                        <th class="text-success fs-5">R$ @Model.Total.ToString("N2")</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="bi bi-box-seam text-muted" style="font-size: 2rem;"></i>
                            <p class="text-muted mt-2">Nenhum produto encontrado nesta ordem.</p>
                        </div>
                    }
                </div>
            </div>

            <!-- Card de Resumo -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="bi bi-graph-up me-2"></i>Resumo da Ordem
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="border-end">
                                <h5 class="text-primary mb-1">@Model.Produtos.Count</h5>
                                <small class="text-muted">Produtos</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border-end">
                                <h5 class="text-success mb-1">@Model.Produtos.Sum(p => p.Quantidade)</h5>
                                <small class="text-muted">Quantidade Total</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border-end">
                                <h5 class="text-info mb-1">@Model.Produtos.Average(p => p.Valor).ToString("C")</h5>
                                <small class="text-muted">Valor Médio</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <h5 class="text-warning mb-1">@Model.Total.ToString("C")</h5>
                            <small class="text-muted">Valor Total</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<br />